<html>
	<head>
		<script type="text/javascript">
			
			function getMotionState() {
				var xhttp = new XMLHttpRequest();
				
				xhttp.onreadystatechange = function() {
					if (xhttp.readyState == 4 && xhttp.status == 200) {
						alert(xhttp.responseText);
					}
				};
				
				xhttp.open("POST", "http://10.0.1.72:3000/getMotionState", true);
				xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xhttp.send("light=1");
			}
			
			function getLights() {
				var xhttp = new XMLHttpRequest();
				
				xhttp.onreadystatechange = function() {
					if (xhttp.readyState == 4 && xhttp.status == 200) {
						var data = JSON.parse(xhttp.responseText);
						
						document.getElementById('lights').innerHTML = "";
						
						var list = document.createElement('ul');
						console.log(data);
						for (var key in data) {
							var node = document.createElement('li');
							var text = document.createTextNode(key);
							var butDiv = document.createElement('div');
							var butClass = document.createAttribute('class');
							butClass.value = 'butDiv';
							butDiv.setAttributeNode(butClass);
							
							var on = document.createElement('button');
							var off = document.createElement('button');
							
							var butClass = document.createAttribute('class');
								butClass.value = "selected";
							
							if (data[key].on == true) {
								on.setAttributeNode(butClass);
							}
							
							if (data[key].on == false) {
								off.setAttributeNode(butClass);
							}
							
							var onOnLoad = document.createAttribute('onclick');
							onOnLoad.value = "setLightState('"+ key +"','cmd','on')";
							var offOnLoad = document.createAttribute('onclick');
							offOnLoad.value = "setLightState('"+ key +"','cmd','off')";
							
							var onText = document.createTextNode('On');
							var offText = document.createTextNode('Off');
							on.setAttributeNode(onOnLoad);
							off.setAttributeNode(offOnLoad);
							on.appendChild(onText);
							off.appendChild(offText);
							
							var testDiv = document.createElement('div');
							var testClass = document.createAttribute('class');
							testClass.value = 'testDiv';
							testDiv.setAttributeNode(testClass);
							
							node.appendChild(text);
							butDiv.appendChild(on);
							butDiv.appendChild(off);
							
							testDiv.appendChild(butDiv);
							
							node.appendChild(testDiv);
							list.appendChild(node);
						}
						
						document.getElementById('lights').appendChild(list);
					}
				};
				
				xhttp.open("POST", "http://10.0.1.72:3000/getLights", true);
				xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xhttp.send();
			}
			
			function getGroups() {
				var xhttp = new XMLHttpRequest();
				
				xhttp.onreadystatechange = function() {
					if (xhttp.readyState == 4 && xhttp.status == 200) {
						var data = JSON.parse(xhttp.responseText);
						
						document.getElementById('groups').innerHTML = "";
						
						var list = document.createElement('ul');
						console.log(data);
						for (var key in data) {
							var node = document.createElement('li');
							var text = document.createTextNode(key);
							node.appendChild(text);
							
							var butDiv = document.createElement('div');
							var butClass = document.createAttribute('class');
							butClass.value = 'butDiv';
							butDiv.setAttributeNode(butClass);
							
							// Make the default button
							var pBut = document.createElement('button');
							var butClick = document.createAttribute('onclick');
							butClick.value = "setGroupPreset('"+key+"','Default');";
							pBut.setAttributeNode(butClick);
							
							if (data[key].activePreset == "DefaultDay" || data[key].activePreset == "DefaultNight") {
								var butClass = document.createAttribute('class');
								butClass.value = "selected";
								pBut.setAttributeNode(butClass);
							}
							
							var butText = document.createTextNode('Default');
							pBut.appendChild(butText);
							butDiv.insertBefore(pBut, butDiv.firstChild);
							
							// Make a button for every preset that isn't a default
							for (var preset in data[key].presets) {
								if (preset != "DefaultDay" && preset != "DefaultNight") {
									var pBut = document.createElement('button');
									var butClick = document.createAttribute('onclick');
									butClick.value = "setGroupPreset('"+key+"','"+preset+"');";
									pBut.setAttributeNode(butClick);
									
									if (data[key].activePreset == preset) {
										var butClass = document.createAttribute('class');
										butClass.value = "selected";
										pBut.setAttributeNode(butClass);
									}
									
									var butText = document.createTextNode(preset);
									pBut.appendChild(butText);
									butDiv.insertBefore(pBut, butDiv.firstChild);
								}
							}
							
							var testDiv = document.createElement('div');
							var testClass = document.createAttribute('class');
							testClass.value = 'testDiv';
							testDiv.setAttributeNode(testClass);
														
							testDiv.appendChild(butDiv);
							node.appendChild(testDiv);
							list.appendChild(node);
							
							var testDiv = document.createElement('div');
							var testClass = document.createAttribute('class');
							testClass.value = 'clear';
							testDiv.setAttributeNode(testClass);
							
							list.appendChild(testDiv);
						}
						
						
						document.getElementById('groups').appendChild(list);
					}
				}
				
				xhttp.open("POST", "http://10.0.1.72:3000/getGroups", true);
				xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xhttp.send();
			}
			
			function getOptions() {
				sendPost("getMotionState","",function(readyState,status,responseText) {
					if (readyState == 4 && status == 200) {
						var tempdata = JSON.parse(responseText);
						
						var onState = tempdata == true ? false : true;
						
						data = {
							'LR Motion':{
								on: onState
							}
						};
						
						document.getElementById('options').innerHTML = "";
						
						var list = document.createElement('ul');
						//console.log(data);
						for (var key in data) {
							//console.log(tempdata);
							
							var node = document.createElement('li');
							var text = document.createTextNode(key);
							var butDiv = document.createElement('div');
							var butClass = document.createAttribute('class');
							butClass.value = 'butDiv';
							butDiv.setAttributeNode(butClass);
							
							var on = document.createElement('button');
							var off = document.createElement('button');
							
							var butClass = document.createAttribute('class');
								butClass.value = "selected";
							
							if (data[key].on == true) {
								on.setAttributeNode(butClass);
							}
							
							if (data[key].on == false) {
								off.setAttributeNode(butClass);
							}
							
							var onOnLoad = document.createAttribute('onclick');
							onOnLoad.value = "setMotionState(false)";
							var offOnLoad = document.createAttribute('onclick');
							offOnLoad.value = "setMotionState(true)";
							
							var onText = document.createTextNode('On');
							var offText = document.createTextNode('Off');
							on.setAttributeNode(onOnLoad);
							off.setAttributeNode(offOnLoad);
							on.appendChild(onText);
							off.appendChild(offText);
							
							var testDiv = document.createElement('div');
							var testClass = document.createAttribute('class');
							testClass.value = 'testDiv';
							testDiv.setAttributeNode(testClass);
							
							node.appendChild(text);
							butDiv.appendChild(on);
							butDiv.appendChild(off);
							
							testDiv.appendChild(butDiv);
							
							node.appendChild(testDiv);
							list.appendChild(node);
						}
						
						document.getElementById('options').appendChild(list);
					}
				});
			}
			
			function refreshDevices() {
				sendPost("findDevices","",function(readyState,status,responseText) {
					if (readyState == 4 && status == 200) {
						getLights();
					}
				});
			}
			
			function setLightState(light,state,val) {
				var result = "light="+ light +"&state=" + state + "&val="+ val;
				sendPost("setLightState",result,function(readyState,status,responseText) {
					if (readyState == 4 && status == 200) {
						getLights();
					}
				});
			}
			
			function setMotionState(disabled) {
				var result = "disabled="+ disabled;
				sendPost("setMotionState",result,function(readyState,status,responseText) {
					if (readyState == 4 && status == 200) {
						getOptions();
					}
				});
			}
			
			function setGroupPreset(groupName,presetName) {
				var result = "groupName=" + groupName + "&presetName=" + presetName;
				sendPost("setGroupPreset",result,function(readyState,status,responseText) {
					if (readyState == 4 && status == 200) {
						getGroups();getLights();
						
						getOptions();
					}
				});
			}
			
			function savePreset() {
				sendPost("savePreset","",function(readyState,status,responseText) {
					
				});
			}
			
			function sendPost(method,data,cb) {
				var xhttp = new XMLHttpRequest();
				
				xhttp.onreadystatechange = function() {
					cb(xhttp.readyState,xhttp.status,xhttp.responseText);
				}
				var uri = "http://10.0.1.72:3000/" + method;
				
				xhttp.open("POST", uri, true);
				xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xhttp.send(data);
			}
			
		</script>
		<style>
			body {
				margin:0px;
			}
			ul {
				list-style: none;
				padding:0;
				width:100%;
				list-style-position: inside;
			}
			
			li {
				height:auto;
				line-height: 50px;
				vertical-align: middle;
				border-bottom: 1px solid #949494;
				padding-left: 5px;
				padding-right:5px;
				margin: 0;
				background-color: hsla(0, 0%, 91%, 1);
				overflow:auto;
			}
			
			li button {
				width:50px;
				height:50px;
				line-height: 50px;
				vertical-align: middle;
				border:none;
				background-color: gray;
				margin-right:10px;
				position: relative;
			}
			
			.testDiv {
				float:right;
				text-align:right;
			}
						
			.selected {
				background-color: green;
			}
			
			.clear {
				clear:both;
			}
			
		</style>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body onload="getLights();getGroups();getOptions();">
		<button onclick="refreshDevices();">Refresh</button>
		<button onclick="savePreset();">Save Preset</button>
		<h2>Lights</h2>
		<div id="lights">
		</div>
		<h2>Groups</h2>
		<div id="groups">
		</div>
		<h2>Options</h2>
		<div id="options">
		</div>
	</body>
</html>